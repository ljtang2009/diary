<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<link rel="stylesheet" href="css/mui.min.css">
		<title>diary</title>
		<style>
			/**
			 * 隐藏滚动条
			 */
			body::-webkit-scrollbar{
				display: none;
			}
		</style>
		<!--<script type="text/javascript">
			// 扩展API是否准备好，如果没有则监听“plusready"事件
			if(window.plus) {
				plusReady();
			} else {
				document.addEventListener("plusready", plusReady, false);
			}
			// 扩展API准备完成后要执行的操作
			function plusReady() {
				var ws = plus.webview.currentWebview(); //pw回车可输出plus.webview
				// ... code
			}
			//打开新Webview窗口
			function openNewWebView(){
				var url = "http://www.dcloud.io/";
				plus.webview.create(url).show();
			}
		</script>-->
	</head>

	<body>
		<div class="mui-content">
			<!--<a href="#" onclick="gotoDetail();">测试</a>-->
			<div id="divGB" style="z-index: 0; width: 100%;">
			</div>
			<div id="divMountain3" style="z-index: 1; width: 60%; position: absolute; right: 0px; background-repeat: no-repeat; background-size: 100% 100%;">
			</div>
			<div id="divMountain2" style="z-index: 2; width: 100%; position: absolute; left: 0px;background-repeat: no-repeat; background-size: 100% 100%;">
			</div>
			<div id="divMountain1" style="z-index: 3; width: 100%; position: absolute; left: 0px;background-repeat: no-repeat; background-size: 100% 100%;">
			</div>
			<div id="divMainButton" style="z-index: 4; position: absolute; border-radius: 100%;">
			</div>
			<div id="divDiaryList" style="z-index: 5; position: absolute; width: 100%; background-color: #A7A63F;">
				<ul style="list-style-type:none; padding: 0; margin: 0;">
					<li style="background-color: red;">1</li>
					<li>2</li>
				</ul>
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/utility.js"></script>
		<script src="lib/greensock/TweenLite.min.js"></script>
		<script src="lib/greensock/plugins/CSSPlugin.min.js"></script>
		<script type="text/javascript">
			var divMountain1 = document.getElementById("divMountain1");
			var divMountain2 = document.getElementById("divMountain2");
			var divMountain3 = document.getElementById("divMountain3");
			var divMainButton = document.getElementById("divMainButton");
			var divMainButtonInitTop;		//主按钮初始化后的位置
			var divMountain1InitTop;		//山1初始化后的位置
			var divMountain2InitTop;		//山2初始化后的位置
			var divMountain3InitTop;		//山3初始化后的位置
			var touchStartY = 0;		//垂直方向拖动的起始位置
			var touchStartMainButtonTop;	//主按钮拖动前的位置
			var tweenAnimationUP;		//向上的动画对象
			var tweenAnimationDown;		//向下的动画对象
			var finishInit = false;		//是否完成初始化
			var tweenMainButtonAnimationBack;		//主按钮回弹的动画对象
			var tweenMountain1AnimationBack;		//山1回弹的动画对象
			var tweenMountain2AnimationBack;		//山2回弹的动画对象
			var tweenMountain3AnimationBack;		//山3回弹的动画对象
			/**
			 * 区分时间的样式
			 */
			var styleWithTime;
			mui.init({
				swipeBack: false,		//关闭侧滑
				statusBarBackground: '#f7f7f7'
			});
			mui.plusReady(function(){
//				//开始拖动
//				document.body.addEventListener('touchstart', function (event) {
//					if (finishInit){
//						//停止主按钮上下晃动的动画
//						if(tweenAnimationUP){
//							tweenAnimationUP.kill();
//						}
//						if(tweenAnimationDown){
//							tweenAnimationDown.kill();
//						}
//						if(tweenMainButtonAnimationBack){
//							tweenMainButtonAnimationBack.kill();
//						}
//						if(tweenMountain1AnimationBack){
//							tweenMountain1AnimationBack.kill();
//						}
//						if(tweenMountain2AnimationBack){
//							tweenMountain2AnimationBack.kill();
//						}
//						if(tweenMountain3AnimationBack){
//							tweenMountain3AnimationBack.kill();
//						}
//						//获取拖动点初始位置
//						touchStartY = event.changedTouches[0].pageY;
//						touchStartMainButtonTop = divMainButton.offsetTop;
//					}
//				}, false);
//				//拖动中
//				document.body.addEventListener('touchmove', function (event) {
//					if (finishInit){
//						//拖动百分比，正式为下拉，负数为上拉
//						var touch_percent = (event.changedTouches[0].pageY - touchStartY) / window.innerHeight;
//						if (touch_percent > 0){
//							divMainButton.style.top = divMainButtonInitTop + (100 * touch_percent) + 'px';
//							divMountain1.style.top = divMountain1InitTop + (100 * touch_percent) + 'px';
//							divMountain2.style.top = divMountain2InitTop + (100 * touch_percent * 0.8) + 'px';
//							divMountain3.style.top = divMountain3InitTop + (100 * touch_percent * 0.6) + 'px';
//						}
//						else {
//							divMainButton.style.top = divMainButtonInitTop + (event.changedTouches[0].pageY - touchStartY) + 'px';
//							divMountain1.style.top = divMountain1InitTop + (event.changedTouches[0].pageY - touchStartY) + 'px';
//							divMountain2.style.top = divMountain2InitTop + (event.changedTouches[0].pageY - touchStartY) + 'px';
//							divMountain3.style.top = divMountain3InitTop + (event.changedTouches[0].pageY - touchStartY) + 'px';
//						}
//					}
//					//取消拖动
//					event.preventDefault();
//				}, false);
//				//拖动结束
//				document.body.addEventListener('touchend', function (event) {
//					if (finishInit){
//						//回到原来位置
//						tweenMainButtonAnimationBack = TweenLite.to(divMainButton, 1, {top: divMainButtonInitTop + "px", onComplete:function(){
//							//开始主键动画
//							setMainButtonAnimation();
//						}});
//						tweenMountain1AnimationBack = TweenLite.to(divMountain1, 1, {top: divMountain1InitTop + "px"});
//						tweenMountain2AnimationBack = TweenLite.to(divMountain2, 1, {top: divMountain2InitTop + "px"});
//						tweenMountain3AnimationBack = TweenLite.to(divMountain3, 1, {top: divMountain3InitTop + "px"});
//					}
//				}, false);
				plus.screen.lockOrientation("portrait-primary");	//锁定竖屏
				plus.device.setWakelock(true);		//屏幕常亮
				styleWithTime = utility.getStyleWithTime();
				//背景
				var divGB = document.getElementById("divGB");
				divGB.style.height = window.innerHeight + 'px';
				divGB.style.background = styleWithTime.bg;
				//moutain1
				divMountain1.style.backgroundImage = "url(image/" + styleWithTime.mountain1 + ")";
				divMountain1.style.height = divMountain1.clientWidth * 0.4 + 'px';
				divMountain1.style.top =  window.innerHeight + 'px';
				//mountain2
				divMountain2.style.backgroundImage = "url(image/" + styleWithTime.mountain2 + ")";
				divMountain2.style.height = divMountain2.clientWidth * 0.4 + 'px';
				divMountain2.style.top =  window.innerHeight + 'px';
				//mountain2
				divMountain3.style.backgroundImage = "url(image/" + styleWithTime.mountain3 + ")";
				divMountain3.style.height = divMountain3.clientWidth * 0.4 + 'px';
				divMountain3.style.top =  window.innerHeight + 'px';
				//初始化主按钮
				divMainButton.style.backgroundColor = styleWithTime.mainButtonColor;
				divMainButton.style.boxShadow = "0px 0px 10px 2px " + styleWithTime.mainButtonColor;
				divMainButton.style.width = divMainButton.style.height = window.innerHeight / 5 + "px";
				divMainButton.style.left = (window.innerWidth / 2) - (divMainButton.clientWidth / 2) + "px";
				//初始化的位置
				TweenLite.to(divMountain1, 0.5, {top: window.innerHeight - divMountain1.clientHeight + 'px'});
				TweenLite.to(divMountain2, 0.8, {top: window.innerHeight - divMountain1.clientHeight - 20 + 'px'});
				TweenLite.to(divMountain3, 1, {top: window.innerHeight - divMountain1.clientHeight - 20 + 'px'});
				TweenLite.to(divMainButton, 1, {top: window.innerHeight / 3 + "px", onComplete:completeInit});
				//获取日记列表
				var diaryList = getDiaryList();
				//显示日记列表
				renderDiaryList(diaryList);
			});
			
			/**
			 * 完成初始化
			 */
			function completeInit(){
				finishInit = true;
				setMainButtonAnimation();
				divMountain1InitTop = divMountain1.offsetTop;
				divMountain2InitTop = divMountain2.offsetTop;
				divMountain3InitTop = divMountain3.offsetTop;
			} 
			
			/**
			 * 设置主按按钮的动画
			 */
			function setMainButtonAnimation(){
				divMainButtonInitTop = divMainButton.offsetTop;
				//升起
				function setMainButtonAnimationUP(){
					tweenAnimationUP = TweenLite.to(divMainButton, 2, {
						top: divMainButtonInitTop - 8 + "px", 
						boxShadow: "0px 0px 0px 0px " + styleWithTime.mainButtonColor,
						onComplete: setMainButtonAnimationDown,
					});
				}
				//下降
				function setMainButtonAnimationDown(){
					tweenAnimationDown = TweenLite.to(divMainButton, 2, {
						top: divMainButtonInitTop + 8 + "px",
						boxShadow: "0px 0px 10px 3px " + styleWithTime.mainButtonColor,
						onComplete: setMainButtonAnimationUP
					});
				}
				setMainButtonAnimationUP();
			}
			/**
			 * 获取日记列表
			 */
			function getDiaryList(){
				var result = [];
				result.push({
					date: '2016-12-09',
					weather: 'fine',
					content: '为了保证扩展API的有效调用，所有应用页面都会用到的重要事件。 应用页面显示时需要首先加载扩展和API代码库，当扩展API代码库加载完成时会触发pluseready事件，当设备触发该事件后，用户就可以安全的调用扩展API。 如果程序中打开多个页面，每个都会收到此事件。',
					image: '/assets/image/IMG_1001.JPG'
				});
				return result;
			}
			/**
			 * 渲染日记列表
			 */
			function renderDiaryList(list){
				
			}
		</script>
	</body>

</html>