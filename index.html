<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" type="text/css" href="style/index.css" />
		<title>diary</title>
	</head>

	<body>
		<header id="header" class="mui-bar">
			<div style="width: 100%; display: flex; justify-content: space-between;">
				<div></div>
				<div></div>
				<div style="display: flex; width: 110px; justify-content: space-between;">
					<div style="padding-top: 8px; width: 50px; text-align: center;"><embed src="image/calendar.svg" onload="changSvgColor(this);" style="width: 26px;" type="image/svg+xml" pluginspage="http://www.adobe.com/svg/viewer/install/"></embed></div>
					<div style="padding-top: 8px; width: 50px; text-align: center;"><embed src="image/setting.svg" onload="changSvgColor(this);" style="width: 26px;" type="image/svg+xml" pluginspage="http://www.adobe.com/svg/viewer/install/"></embed></div>
				</div>
			</div>
		</header>
		<div class="mui-content">
			<!--<a href="#" onclick="gotoDetail();">测试</a>-->
			<div id="divGB" style="z-index: 0; width: 100%;">
			</div>
			<div id="divMountain3" style="z-index: 1; width: 60%; position: absolute; right: 0px; background-repeat: no-repeat; background-size: 100% 100%;">
			</div>
			<div id="divMountain2" style="z-index: 2; width: 100%; position: absolute; left: 0px;background-repeat: no-repeat; background-size: 100% 100%;">
			</div>
			<div id="divMountain1" style="z-index: 3; width: 100%; position: absolute; left: 0px;background-repeat: no-repeat; background-size: 100% 100%;">
			</div>
			<div id="divStar1" style="width: 10px; height: 10px; border-radius: 100%; background-color: #9EBEDF; position: absolute; z-index: 5; display: none; opacity: 1;"></div>
			<div id="divStar2" style="width: 12px; height: 12px; border-radius: 100%; background-color: #9EBEDF; position: absolute; z-index: 5; display: none; opacity: 0.5;"></div>
			<div id="divStar3" style="width: 7px; height: 7px; border-radius: 100%; background-color: #9EBEDF; position: absolute; z-index: 5; display: none; opacity: 0.2;"></div>
			<div id="divCloud1" style="position: absolute; z-index: 5; display: none;"><img src="image/cloud/cloud1.png" style="width: 50px;" /></div>
			<div id="divCloud2" style="position: absolute; z-index: 5; display: none;"><img src="image/cloud/cloud2.png" style="width: 60px;" /></div>
			<div id="divMainButton" style="z-index: 4; position: absolute; border-radius: 100%;">
			</div>
			<div id="divDiaryList" style="z-index: 5; position: relative; margin-top: 0; width: 100%; padding-bottom: 10px;">
				<ul id="ulDairyList" style="list-style-type:none; padding: 0; margin: 0;" class="mui-table-view">
				</ul>
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/utility.js"></script>
		<script src="lib/greensock/TweenLite.min.js"></script>
		<script src="lib/greensock/plugins/CSSPlugin.min.js"></script>
		<script src="lib/greensock/plugins/ScrollToPlugin.min.js"></script>
		<script src="lib/clamp/clamp.min.js"></script>
		<script src="lib/handlebars/handlebars.min.js"></script>
		<script src="lib/moment/moment.min.js"></script>
		<script id="diaryItemTempte" type="text/x-handlebars-template">
			<div class="mui-slider-right mui-disabled">
				<a class="mui-btn mui-btn-red mui-icon mui-icon-trash"></a>
			</div>
			<div style="display: flex;" class="mui-slider-handle">
				<div class="divDiaryTimelineLeft">
					<div>{{yearMonth}}</div>
					<div>{{dayOfWeekChinese}}</div>
					<div class="svgTimelineContainer">
						<div><embed name='svg' src="image/weather/{{weather}}.svg" onload="changSvgColor(this);" class="svgTimeline" type="image/svg+xml" pluginspage="http://www.adobe.com/svg/viewer/install/"></embed>
						</div>
						{{# if expression}}
						<div><embed name='svgTimeline' onload="changSvgColor(this);" src="image/expression/{{expression}}.svg" class="svgTimeline" type="image/svg+xml" pluginspage="http://www.adobe.com/svg/viewer/install/"></embed>
						</div>{{/if}} {{# if hasPicture}}
						<div><embed name='svgTimeline' onload="changSvgColor(this);" src="image/fileIcon/picture.svg" class="svgTimeline" type="image/svg+xml" pluginspage="http://www.adobe.com/svg/viewer/install/"></embed>
						</div>{{/if}} {{# if hasAudio}}
						<div><embed name='svgTimeline' onload="changSvgColor(this);" src="image/fileIcon/audio.svg" class="svgTimeline" type="image/svg+xml" pluginspage="http://www.adobe.com/svg/viewer/install/"></embed>
						</div>{{/if}} {{# if hasVideo}}
						<div><embed name='svgTimeline' onload="changSvgColor(this);" src="image/fileIcon/video.svg" class="svgTimeline" type="image/svg+xml" pluginspage="http://www.adobe.com/svg/viewer/install/"></embed>
						</div>{{/if}}
					</div>
				</div>
				<div class="divTimelineLineContainer">
					<div class="divTimelineLineUP" style="{{# if hasLast}}visibility: visible;{{~^~}}visibility: hidden;{{/if}}"></div>
					<div class="divTimelineLineText">{{day}}</div>
					<div class="divTimelineLineDown" style="{{# if hasNext}}visibility: visible;{{~^~}}visibility: hidden;{{/if}}"></div>
				</div>
				<div style="flex-grow: 100;">
					<div class="divDiaryContentItem">
						<div name="divDiaryText" class="divDiaryContentText">{{content}}</div>
						<div class="divDiaryContentImg" style="{{#if hasPicture}}display: block;{{~^~}}display: none;{{/if}}"><img src="{{image}}"></div>
					</div>
				</div>
			</div>
		</script>
		<script src="js/view/indexView.js"></script>
		<script>
			var divMountain1 = document.getElementById("divMountain1");
			var divMountain2 = document.getElementById("divMountain2");
			var divMountain3 = document.getElementById("divMountain3");
			var divMainButton = document.getElementById("divMainButton");
			var divDiaryList = document.getElementById('divDiaryList');
			var ulDairyList = document.getElementById('ulDairyList');
			var sourceDiaryItem = document.getElementById('diaryItemTempte').innerHTML;
			var templateDiaryItem = Handlebars.compile(sourceDiaryItem);
			var divMainButtonInitTop; //主按钮初始化后的位置
			var divMountain1InitTop; //山1初始化后的位置
			var divMountain2InitTop; //山2初始化后的位置
			var divMountain3InitTop; //山3初始化后的位置
			var touchStartY = 0; //垂直方向拖动的起始位置
			var touchStartMainButtonTop; //主按钮拖动前的位置
			var tweenAnimationUP; //向上的动画对象
			var tweenAnimationDown; //向下的动画对象
			var finishInit = false; //是否完成初始化
			var tweenMainButtonAnimationBack; //主按钮回弹的动画对象
			var tweenMountain1AnimationBack; //山1回弹的动画对象
			var tweenMountain2AnimationBack; //山2回弹的动画对象
			var tweenMountain3AnimationBack; //山3回弹的动画对象
			var tweenStar1AnimationShow;	//star1显示动画
			var tweenStar1AnimationHide;	//star1隐藏动画
			var tweenStar2AnimationShow;	//star2显示动画
			var tweenStar2AnimationHide;	//star2隐藏动画
			var tweenStar3AnimationShow;	//star3显示动画
			var tweenStar3AnimationHide;	//star3隐藏动画
			var tweenCloud1AnimationMove;	//cloud1移动动画
			var tweenCloud2AnimationMove;	//cloud1移动动画
			var styleWithTime = utility.getStyleWithTime();//区分时间的样式
			var isNight = utility.isNight();
			mui.init({
				swipeBack: false, //关闭侧滑
			});
			mui.plusReady(function() {
				//				//开始拖动
				//				document.body.addEventListener('touchstart', function (event) {
				//					if (finishInit){
				//						//停止主按钮上下晃动的动画
				//						if(tweenAnimationUP){
				//							tweenAnimationUP.kill();
				//						}
				//						if(tweenAnimationDown){
				//							tweenAnimationDown.kill();
				//						}
				//						if(tweenMainButtonAnimationBack){
				//							tweenMainButtonAnimationBack.kill();
				//						}
				//						if(tweenMountain1AnimationBack){
				//							tweenMountain1AnimationBack.kill();
				//						}
				//						if(tweenMountain2AnimationBack){
				//							tweenMountain2AnimationBack.kill();
				//						}
				//						if(tweenMountain3AnimationBack){
				//							tweenMountain3AnimationBack.kill();
				//						}
				//						//获取拖动点初始位置
				//						touchStartY = event.changedTouches[0].pageY;
				//						touchStartMainButtonTop = divMainButton.offsetTop;
				//					}
				//				}, false);
				//				//拖动中
				//				document.body.addEventListener('touchmove', function (event) {
				//					if (finishInit){
				//						//拖动百分比，正式为下拉，负数为上拉
				//						var touch_percent = (event.changedTouches[0].pageY - touchStartY) / window.innerHeight;
				//						if (touch_percent > 0){
				//							divMainButton.style.top = divMainButtonInitTop + (100 * touch_percent) + 'px';
				//							divMountain1.style.top = divMountain1InitTop + (100 * touch_percent) + 'px';
				//							divMountain2.style.top = divMountain2InitTop + (100 * touch_percent * 0.8) + 'px';
				//							divMountain3.style.top = divMountain3InitTop + (100 * touch_percent * 0.6) + 'px';
				//						}
				//						else {
				//							divMainButton.style.top = divMainButtonInitTop + (event.changedTouches[0].pageY - touchStartY) + 'px';
				//							divMountain1.style.top = divMountain1InitTop + (event.changedTouches[0].pageY - touchStartY) + 'px';
				//							divMountain2.style.top = divMountain2InitTop + (event.changedTouches[0].pageY - touchStartY) + 'px';
				//							divMountain3.style.top = divMountain3InitTop + (event.changedTouches[0].pageY - touchStartY) + 'px';
				//						}
				//					}
				//					//取消拖动
				//					event.preventDefault();
				//				}, false);
				//				//拖动结束
				//				document.body.addEventListener('touchend', function (event) {
				//					if (finishInit){
				//						//回到原来位置
				//						tweenMainButtonAnimationBack = TweenLite.to(divMainButton, 1, {top: divMainButtonInitTop + "px", onComplete:function(){
				//							//开始主键动画
				//							setMainButtonAnimation();
				//						}});
				//						tweenMountain1AnimationBack = TweenLite.to(divMountain1, 1, {top: divMountain1InitTop + "px"});
				//						tweenMountain2AnimationBack = TweenLite.to(divMountain2, 1, {top: divMountain2InitTop + "px"});
				//						tweenMountain3AnimationBack = TweenLite.to(divMountain3, 1, {top: divMountain3InitTop + "px"});
				//					}
				//				}, false);
				isIOS = plus.os.name.toLowerCase().indexOf('ios') >= 0;
				plus.screen.lockOrientation("portrait-primary"); //锁定竖屏
				plus.device.setWakelock(true); //屏幕常亮
				//初始化样式
				indexView.initStyle(function() {
					//滚动事件
					window.onscroll = function(e) {
						//console.log(window.pageYOffset);
					}
					//获取日记列表
					var diaryList = getDiaryList();
					//显示日记列表
					indexView.renderDiaryList(diaryList);
					completeInit(); //完成初始化
				});
			});

			/**
			 * 完成初始化
			 */
			function completeInit() {
				finishInit = true;
				indexView.setMainButtonAnimation();
				divMountain1InitTop = divMountain1.offsetTop;
				divMountain2InitTop = divMountain2.offsetTop;
				divMountain3InitTop = divMountain3.offsetTop;
			}

			/**
			 * 获取日记列表
			 */
			function getDiaryList() {
				var result = [];
				result.push({
					date: '2016-12-09',
					weather: 'fine',
					content: '为了保证扩展API的有效调用，所有应用页面都会用到的重要事件。 应用页面显示时需要首先加载扩展和API代码库，当扩展API代码库加载完成时会触发pluseready事件，当设备触发该事件后，用户就可以安全的调用扩展API。 如果程序中打开多个页面，每个都会收到此事件。',
					image: 'assets/image/IMG_1001.JPG',
					expression: 'happy',
					hasPicture: true,
					hasAudio: true,
					hasVideo: true,
					hasLast: false,
					hasNext: true
				});
				result.push({
					date: '2016-12-09',
					weather: 'rain',
					content: '为了保证扩展API的有效调用，所有应用页面都会用到的重要事件。 应用页面显示时需要首先加载扩展和API代码库，当扩展API代码库加载完成时会触发pluseready事件，当设备触发该事件后，用户就可以安全的调用扩展API。 如果程序中打开多个页面，每个都会收到此事件。',
					image: 'assets/image/IMG_1001.JPG',
					expression: 'anger',
					hasPicture: true,
					hasAudio: false,
					hasVideo: false,
					hasLast: true,
					hasNext: true
				});
				result.push({
					date: '2016-12-09',
					weather: 'rain',
					content: '为了保证扩展API的有效调用，所有应用页面都会用到的重要事件。 应用页面显示时需要首先加载扩展和API代码库，当扩展API代码库加载完成时会触发pluseready事件，当设备触发该事件后，用户就可以安全的调用扩展API。 如果程序中打开多个页面，每个都会收到此事件。',
					image: 'assets/image/IMG_1001.JPG',
					expression: 'anger',
					hasPicture: true,
					hasAudio: false,
					hasVideo: false,
					hasLast: true,
					hasNext: true
				});
				result.push({
					date: '2016-12-09',
					weather: 'rain',
					content: '为了保证扩展API的有效调用，所有应用页面都会用到的重要事件。 应用页面显示时需要首先加载扩展和API代码库，当扩展API代码库加载完成时会触发pluseready事件，当设备触发该事件后，用户就可以安全的调用扩展API。 如果程序中打开多个页面，每个都会收到此事件。',
					image: 'assets/image/IMG_1001.JPG',
					expression: 'anger',
					hasPicture: true,
					hasAudio: false,
					hasVideo: false,
					hasLast: true,
					hasNext: true
				});
				result.push({
					date: '2016-12-09',
					weather: 'cloudy',
					content: '为了保证扩展API的有效调用，所有应用页面都会用到的重要事件。 应用页面显示时需要首先加载扩展和API代码库，当扩展API代码库加载完成时会触发pluseready事件，当设备触发该事件后，用户就可以安全的调用扩展API。 如果程序中打开多个页面，每个都会收到此事件。',
					expression: 'cry',
					hasPicture: false,
					hasAudio: true,
					hasVideo: true,
					hasLast: true,
					hasNext: false
				});
				return result;
			}

			/**
			 * 改变svg颜色
			 * @param {Object} e
			 */
			function changSvgColor(sender) {
				if (styleWithTime && styleWithTime.mainButtonColor){
						utility.setSvgColor({
						containerArray: [sender],
						color: styleWithTime.mainButtonColor
					});
				}
			}
		</script>
	</body>

</html>